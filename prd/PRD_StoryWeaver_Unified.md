# StoryWeaver AI (智语拆解) - 统一需求规格说明书

**版本**: 3.0 (Consolidated)  
**日期**: 2026-02-14  
**状态**: 整理完成待评审  
**合并来源**: PRD_StoryWeaver.md (v1.0) + PRD_StoryWeaver_Phase2.md (v2.0/v2.1)

---

## 📑 目录

1. [项目概述](#1-项目概述)
2. [功能需求](#2-功能需求)
3. [非功能性需求](#3-非功能性需求)
4. [技术架构](#4-技术架构)
5. [实施路线图](#5-实施路线图)
6. [成功标准与指标](#6-成功标准与指标)
7. [附录：需求对照表](#7-附录需求对照表)

---

## 1. 项目概述

### 1.1 项目信息

| 属性 | 内容 |
|------|------|
| **中文名称** | 智语拆解 |
| **英文名称** | StoryWeaver AI |
| **项目代号** | SW-Core |
| **当前阶段** | Phase 1 + Phase 2 整合版 |
| **文档版本** | v3.0 Consolidated |

### 1.2 愿景与目标

**核心愿景**: 构建智能化的需求拆解平台，打通"需求 → 设计 → 开发"的全流程自动化闭环，将需求拆解耗时从"小时级"降低至"分钟级"。

**Phase 1 目标**: 实现 PRD 文档到标准化敏捷用户故事的自动转化
**Phase 2 目标**: 实现故事地图规划、设计一致性审计、接口文档自动生成

### 1.3 目标用户画像

| 角色 | 核心痛点 | Phase 1 价值 | Phase 2 价值 |
|------|----------|--------------|--------------|
| **产品经理 (PM)** | 手动拆解需求耗时，格式不统一 | 自动生成标准用户故事，减少重复工作 | 自动规划迭代，审计设计一致性 |
| **技术负责人** | 需求范围评估困难，工时估算不准 | 快速评估需求范围 | 可视化故事地图，辅助决策 |
| **敏捷教练/Scrum Master** | 用户故事格式不规范 | 强制标准模板 | 故事地图支持敏捷规划 |
| **UI/UX 设计师** | 设计与需求不一致 | - | 自动审计设计覆盖度 |
| **开发工程师** | 手动编写接口文档耗时 | - | 自动生成 OpenAPI 规范 |

### 1.4 核心价值主张

1. **效率倍增**: 自动化处理替代人工逐行拆解，释放核心生产力
2. **标准统一**: 强制应用"角色-活动-价值"标准模板，避免需求描述随意
3. **防遗漏**: 结构化解析确保非功能性需求和边缘流程不被忽视
4. **闭环协同**: 打通需求-设计-开发链路，消除信息孤岛

---

## 2. 功能需求

### 2.1 Phase 1: 核心拆解能力

#### 2.1.1 PRD文档上传模块

**功能描述**: 提供直观的上传界面，支持多种文档格式，并进行基础校验

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **支持格式** | .docx (Word), .pdf (PDF), .txt (纯文本), .md (Markdown) | P0 |
| **上传方式** | 拖拽上传区域 + 点击选择文件按钮 | P0 |
| **进度显示** | 实时显示上传进度条（百分比）及成功/失败状态图标 | P0 |
| **文件大小限制** | 单文件不超过 20MB | P0 |
| **空文件校验** | 拦截内容为空的无效文档，返回明确错误提示 | P0 |
| **格式校验** | 校验文件扩展名与 MIME 类型一致性 | P1 |

**验收标准**:
- [ ] 支持所列所有格式的文件上传
- [ ] 20MB 以上文件被拒绝并给出友好提示
- [ ] 上传进度实时更新，误差不超过 5%
- [ ] 空文件上传时显示"文件内容为空"错误

#### 2.1.2 文档内容解析引擎

**功能描述**: 后端服务接收文件，提取文本内容并进行结构化解析

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **文件接收** | 后端接口接收文件流，生成唯一 file_id | P0 |
| **临时存储** | 文件临时存储，处理完成后按策略保留或删除 | P0 |
| **Word 解析** | 集成 python-docx 库提取文本 | P0 |
| **PDF 解析** | 集成 PyPDF2/pdfplumber 库提取文本 | P0 |
| **文本清洗** | 去除页眉、页脚、水印及无关格式字符 | P1 |
| **章节识别** | 基于正则和关键词识别文档结构（功能需求/非功能需求/流程图） | P1 |
| **段落分类** | 将文本块标记为业务背景/功能描述/验收标准等类别 | P1 |

**验收标准**:
- [ ] 标准格式 Word 文档解析成功率 100%
- [ ] 10页（约5000字）文档处理时间不超过 30秒
- [ ] 支持 10 个并发文档处理请求
- [ ] 扫描件 PDF 返回"无法识别扫描件"提示

#### 2.1.3 用户故事自动生成

**功能描述**: 核心算法将解析的文本转化为标准化用户故事

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **标准模板** | As a <角色>, I want to <活动/功能>, So that <商业价值/收益> | P0 |
| **动词提取** | 识别"用户可以..."、"支持..."等句式提取功能点 | P0 |
| **角色映射** | 自动识别管理员/普通用户/访客等实体填充角色字段 | P0 |
| **价值推导** | 未显式提及价值时基于上下文生成默认值，标记"需人工确认" | P1 |
| **故事属性** | Title(功能摘要), Description(标准故事文本), Source Reference(原文片段) | P0 |
| **置信度评分** | 为每个生成的故事计算置信度分数(0-1) | P1 |

**验收标准**:
- [ ] 生成的故事 60% 以上无需修改即可直接使用
- [ ] 标准格式文档的故事生成准确率 > 85%
- [ ] 每个故事包含可追溯的 Source Reference
- [ ] 角色识别准确率 > 80%

#### 2.1.4 用户故事展示与管理

**功能描述**: 前端界面展示生成的故事，支持编辑、排序、过滤和导出

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **展示布局** | 卡片式或列表式布局，左侧显示文档概览，右侧显示拆解结果 | P0 |
| **故事编辑** | 允许手动修改故事标题和描述 | P0 |
| **排序过滤** | 按功能模块筛选，按生成置信度排序 | P1 |
| **删除新增** | 支持删除误生成的故事或手动补充遗漏故事 | P1 |
| **CSV 导出** | 包含 Title, Description, Module, Priority 字段 | P0 |
| **Markdown 复制** | 一键复制格式化文本 | P1 |

**验收标准**:
- [ ] 故事列表加载时间 < 2秒（100条以内）
- [ ] 编辑操作实时保存，无数据丢失
- [ ] CSV 导出文件可被 Jira/Excel 正确识别
- [ ] 移动端可正常查看结果（响应式布局）

### 2.2 Phase 2: 高级功能

#### 2.2.1 用户故事地图 (Story Map)

**功能描述**: 将离散故事转化为具备时间维度和逻辑层级的可视化故事地图

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **数据导入** | 支持从 Phase 1 结果直接导入或手动录入结构化数据 | P0 |
| **手动录入字段** | 标题、描述、角色、验收标准、优先级(P0-P2)、估算点数、依赖 ID | P0 |
| **智能规划引擎** | 基于 MoSCoW 原则或数值优先级排序 | P0 |
| **依赖识别** | 识别故事间的阻塞关系(Blocking Relations) | P1 |
| **排期建议** | 根据团队 Velocity 自动分配故事至 Release 和 Sprint | P0 |
| **四级结构** | 骨干(Activities) → 任务(Tasks) → 故事(Stories) → 细节(Acceptance Criteria) | P0 |
| **拖拽操作** | 支持拖拽调整故事所属的 Sprint 或优先级，实时重计算排期 | P0 |
| **发布线** | 清晰标记不同版本的交付边界 | P1 |
| **PNG/SVG 导出** | 导出为图片用于 PPT 汇报 | P1 |
| **JSON/Excel 导出** | 导出数据用于导入 Jira 等工具 | P1 |

**验收标准**:
- [ ] 自动排期满足"高优先级优先"且"依赖项在前"的逻辑
- [ ] 地图视图加载及拖拽操作响应时间 < 2秒
- [ ] 支持同时展示 200+ 个故事节点，首屏渲染 < 1.5秒
- [ ] 导出的数据文件包含所有层级和排期信息
- [ ] 从故事列表生成完整地图并完成首次排期的时间 < 10分钟

#### 2.2.2 Figma 设计稿智能审计

**功能描述**: 将 Figma 设计稿与 PRD 进行语义对齐，自动发现设计遗漏、多余设计或逻辑不一致

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **Figma 集成** | 输入 Figma File URL，通过 PAT 授权访问 | P0 |
| **数据提取** | 提取 Frames, Components, Text Layers, Layers Hierarchy | P0 |
| **语义比对** | 利用 NLP 将 PRD 功能点与 Figma 画板名称/文字内容映射 | P1 |
| **组件关联** | 建立 UI 组件与 PRD 交互操作的关联 | P1 |
| **遗漏项检测** | PRD 提及的功能页面在 Figma 中未找到对应画板 | P0 |
| **冗余项检测** | Figma 中存在复杂页面但 PRD 中无对应需求 | P1 |
| **歧义检测** | 如 PRD 描述"搜索框在顶部"设计稿却放在侧边栏 | P1 |
| **交互式定位** | 点击报告问题项可联动打开预览并定位到 Figma 节点和 PRD 段落 | P1 |

**验收标准**:
- [ ] 成功解析包含至少 100 个节点的复杂 Figma 文件
- [ ] 审计报告有效问题(True Positives)占比不低于 85%
- [ ] 中型项目(约 50 个画板)审计耗时 < 5分钟
- [ ] Figma 节点提取与缓存机制确保重复审计响应时间 < 30秒
- [ ] Figma Access Token 加密存储，支持随时撤销授权

#### 2.2.3 接口文档自动生成

**功能描述**: 综合 PRD 业务逻辑与 Figma UI 结构，自动推导 API 接口文档

**详细规格**:

| 需求项 | 规格说明 | 优先级 |
|--------|----------|--------|
| **实体识别** | 从 PRD 提取核心名词作为 API 数据模型 Schemas | P0 |
| **表单字段推导** | 分析 Figma 表单组件推导 POST/PUT 请求 Request Body | P0 |
| **列表字段推导** | 分析 Figma 列表/表格组件推导 GET 请求 Response Body | P0 |
| **OpenAPI 3.0** | 自动生成标准 Swagger YAML/JSON | P0 |
| **规范定义** | 定义 Path, Method, Parameters, Responses, Headers | P0 |
| **Swagger UI 预览** | 提供 Web 端预览功能 | P1 |
| **在线编辑** | 允许开发人员在线微调字段类型或描述 | P1 |

**验收标准**:
- [ ] 生成的接口覆盖 PRD 中 90% 以上的数据交互场景
- [ ] 导出的 YAML 文件通过 Swagger Editor 标准校验
- [ ] 字段名称与 Figma 文本标签或组件名称具有语义一致性
- [ ] 后端支持 50 个并发的 API 文档生成请求

## 3. 非功能性需求

### 3.1 性能要求

| 指标 | Phase 1 要求 | Phase 2 要求 |
|------|--------------|--------------|
| **文档处理** | 10页(5000字)文档 < 30秒 | - |
| **并发处理** | 10 个并发请求 | 50 个并发请求(API 生成) |
| **故事地图渲染** | - | 200+ 节点首屏 < 1.5秒 |
| **拖拽响应** | - | < 2秒 |
| **Figma 审计** | - | 50 画板 < 5分钟 |

### 3.2 可用性要求

- **零学习成本**: 操作流程限制在 3 步以内（上传 → 等待 → 查看/导出）
- **移动端适配**: 支持移动端查看结果（响应式布局）
- **错误提示**: 所有错误提供明确、可操作的提示信息

### 3.3 安全性要求

| 需求项 | 具体要求 |
|--------|----------|
| **数据隐私** | PRD 文档默认为临时会话级，退出或过期后自动删除 |
| **传输安全** | 强制使用 HTTPS |
| **敏感信息过滤** | (可选)解析阶段识别并掩盖手机号、身份证号等 |
| **Token 加密** | Figma PAT 和 Lark App Secret 必须加密存储 |
| **审计日志** | 记录所有 API 导出及计划修改操作 |

### 3.4 可靠性要求

- **异常处理**: 扫描件 PDF 返回明确提示，解析超时提供重试机制
- **容错性**: API 限流或网络异常时不导致程序崩溃
- **数据完整性**: 导出文件包含完整信息，无字段缺失

### 3.5 兼容性要求

- **Figma API**: 支持 Figma REST API v1 及以上
- **浏览器**: 完美支持 Chrome, Edge, Safari 等主流浏览器
- **文件格式**: Word, PDF, TXT, Markdown

---

## 4. 技术架构

### 4.1 技术栈选型

**实际项目技术栈** (基于代码库分析):

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端框架** | React 18 + TypeScript | 组件化开发，类型安全 |
| **构建工具** | Vite 6 | 快速开发服务器，优化构建 |
| **样式方案** | Tailwind CSS v4 | 原子化 CSS，通过 @tailwindcss/vite 插件集成 |
| **UI 组件库** | Radix UI + shadcn/ui 风格 | 无头组件 + 自定义样式 |
| **图标** | lucide-react | 现代化图标库 |
| **动画** | motion (Framer Motion) | 流畅动画效果 |
| **表单** | react-hook-form | 表单状态管理 |
| **拖拽** | @dnd-kit/core | 现代化拖拽方案 |

**原 PRD 规划技术栈** (供参考):

| 层级 | 规划技术 | 实际采用 |
|------|----------|----------|
| 前端 | Flutter (Web) | React 18 + TypeScript |
| 后端 | Python FastAPI | (前端项目，无后端) |
| 数据库 | SQLite → PostgreSQL | (前端项目，本地存储) |

### 4.2 项目结构

```
src/
├── main.tsx                 # 应用入口 (React 18 createRoot)
├── styles/                  # 全局样式
│   ├── index.css           # 主样式入口
│   ├── fonts.css           # 字体定义
│   ├── tailwind.css        # Tailwind 基础
│   └── theme.css           # 主题变量
└── app/
    ├── App.tsx              # 根组件
    └── components/
        ├── ui/               # 可复用 UI 组件 (50+ 组件)
        ├── figma/            # Figma 相关组件
        ├── FileUpload.tsx    # 文件上传模块
        ├── StoryCard.tsx     # 故事卡片
        ├── StoryList.tsx     # 故事列表
        ├── StoryMap.tsx      # 故事地图
        ├── FigmaAudit.tsx    # Figma 审计
        └── APIGenerator.tsx  # API 生成器
```

### 4.3 路径别名

- `@/` 解析到 `src/` 目录
- 示例: `import Button from "@/app/components/ui/button"`

---

## 5. 实施路线图

### 5.1 总体时间线

```
Month 1-2: Phase 1 核心功能
├── Week 1-2: 基础架构 + 上传模块
├── Week 3-4: 文档解析 + 故事生成
└── Week 5-6: 展示管理 + 导出功能

Month 3-4: Phase 2 高级功能
├── Week 7-8: 故事地图
├── Week 9-10: Figma 审计
└── Week 11-12: API 生成器

Month 5: 优化与发布
├── Week 15-16: 性能优化 + Bug 修复
└── Week 17-18: 测试 + 文档 + 发布
```

### 5.2 详细里程碑

#### 里程碑 1: Phase 1 MVP (Week 1-6)

**目标**: 实现"上传 → 解析 → 展示 → 导出"核心闭环

| 周次 | 任务 | 交付物 | 成功标准 |
|------|------|--------|----------|
| Week 1-2 | 基础架构搭建<br>上传模块开发 | 可运行的上传界面<br>文件校验功能 | 支持 4 种格式上传<br>20MB 限制生效 |
| Week 3-4 | 文档解析引擎<br>故事生成算法 | 文本提取功能<br>故事生成逻辑 | 解析成功率 > 95%<br>生成准确率 > 80% |
| Week 5-6 | 故事展示界面<br>导出功能 | 故事卡片组件<br>CSV/Markdown 导出 | 编辑功能可用<br>导出格式正确 |

#### 里程碑 2: Phase 2 故事地图 (Week 7-8)

**目标**: 实现可视化的故事地图规划

| 周次 | 任务 | 交付物 | 成功标准 |
|------|------|--------|----------|
| Week 7 | 地图数据结构<br>可视化组件 | 四级结构展示<br>基础拖拽功能 | 200+ 节点流畅渲染 |
| Week 8 | 智能排期算法<br>导出功能 | 自动 Sprint 分配<br>PNG/SVG 导出 | 排期逻辑正确<br>导出图片清晰 |

#### 里程碑 3: Phase 2 Figma 审计 (Week 9-10)

**目标**: 实现设计与需求的智能比对

| 周次 | 任务 | 交付物 | 成功标准 |
|------|------|--------|----------|
| Week 9 | Figma API 集成<br>数据提取 | PAT 授权流程<br>节点解析功能 | 支持 100+ 节点文件 |
| Week 10 | 语义比对算法<br>审计报告 | 遗漏/冗余检测<br>交互式报告 | 准确率 > 85% |

#### 里程碑 4: Phase 2 API 生成器 (Week 11-12)

**目标**: 实现自动化的接口文档生成

| 周次 | 任务 | 交付物 | 成功标准 |
|------|------|--------|----------|
| Week 11 | 实体识别<br>字段推导 | 数据模型生成<br>Request/Response 推导 | 覆盖 90% 场景 |
| Week 12 | OpenAPI 适配<br>预览编辑 | Swagger YAML 导出<br>UI 预览 | 通过 Swagger 校验 |

#### 里程碑 5: 优化与发布 (Week 13-16)

**目标**: 性能优化、Bug 修复、正式发布

| 周次 | 任务 | 交付物 |
|------|------|--------|
| Week 13-14 | 性能优化<br>Bug 修复 | 优化后的系统 |
| Week 15-16 | 全面测试<br>文档完善<br>正式发布 | 测试报告<br>用户文档<br>生产环境 |

### 5.3 风险评估与缓解

| 风险项 | 影响 | 概率 | 缓解策略 |
|--------|------|------|----------|
| Figma 文档结构复杂导致解析失败 | 高 | 中 | 预设标准组件命名规范；提供手动映射补救 |
| LLM 语义匹配误报或漏报 | 中 | 中 | 引入置信度分值；允许用户标记忽略/确认 |
| API 字段与实际开发习惯不符 | 中 | 中 | 提供灵活模板配置；预览阶段批量重命名 |
| 性能不达标(大文件处理慢) | 高 | 中 | 实现分片处理；增加进度指示；优化算法 |
| 浏览器兼容性问题 | 中 | 低 | 早期进行跨浏览器测试；使用兼容性好的库 |

---

## 6. 成功标准与指标

### 6.1 功能完成度指标

| 功能模块 | Phase | 权重 | 完成标准 |
|----------|-------|------|----------|
| PRD 文档上传 | 1 | 15% | 支持所有格式，校验正确 |
| 文档内容解析 | 1 | 15% | 解析成功率 > 95% |
| 用户故事生成 | 1 | 20% | 准确率 > 80%，60% 可用 |
| 故事展示管理 | 1 | 10% | 编辑导出功能完整 |
| 用户故事地图 | 2 | 20% | 可视化可用，排期正确 |
| Figma 审计 | 2 | 15% | 准确率 > 85% |
| API 生成器 | 2 | 15% | 覆盖 90% 场景 |

### 6.2 性能指标

- **文档处理**: 10页文档 < 30秒
- **故事地图**: 200+ 节点首屏 < 1.5秒
- **Figma 审计**: 50 画板 < 5分钟
- **API 生成**: < 10秒

### 6.3 用户体验指标

- **零学习成本**: 3 步完成核心流程
- **全流程时间**: 从上传到获取 CSV < 1分钟
- **地图规划时间**: 生成地图并完成排期 < 10分钟
- **移动端可用**: 核心功能可在手机查看

### 6.4 业务价值指标

- **效率提升**: 需求拆解从"小时级"降至"分钟级"
- **质量提升**: 80% 以上生成故事可直接使用
- **协作提升**: 设计-需求一致性审计准确率 85%+
- **开发加速**: 接口文档减少 50% 沟通时间

---

## 7. 附录：需求对照表

### 7.1 原始 PRD 来源对照

| 本 PRD 章节 | Phase 1 来源 | Phase 2 来源 |
|-------------|--------------|--------------|
| 2.1.1 PRD文档上传 | 2.1 PRD文档上传模块 | - |
| 2.1.2 文档内容解析 | 2.2 文档内容解析与处理引擎 | - |
| 2.1.3 用户故事自动生成 | 2.3 用户故事自动生成模块 | - |
| 2.1.4 用户故事展示与管理 | 2.4 用户故事输出与展示模块 | - |
| 2.2.1 用户故事地图 | - | 3.1 自动用户故事地图规划与制作 |
| 2.2.2 Figma 设计稿智能审计 | - | 3.2 Figma 设计稿与 PRD 内容智能匹配与审计 |
| 2.2.3 接口文档自动生成 | - | 3.3 基于 PRD 与 Figma 设计稿的接口文档自动生成 |
| 3.1 性能要求 | 3.1 性能 | 4.1 性能 |
| 3.2 可用性要求 | 3.2 可用性 | - |
| 3.3 安全性要求 | 3.3 安全性 | 4.2 安全性与合规性 |
| 3.4 可靠性要求 | 3.4 可靠性 | - |
| 3.5 兼容性要求 | - | 4.3 兼容性 |

### 7.2 优先级定义

| 优先级 | 定义 | 说明 |
|--------|------|------|
| **P0** | 必须有 (Must Have) | 核心功能，没有则产品不可用 |
| **P1** | 应该有 (Should Have) | 重要功能，提升用户体验 |
| **P2** | 可以有 (Nice to Have) | 增值功能，可后续迭代 |

### 7.3 需求变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2026-01-25 | Phase 1 初始版本 | SW-Team |
| v2.0 | 2026-01-28 | Phase 2 需求规划 | Trae AI |
| **v3.0** | **2026-02-14** | **合并 Phase 1+2，移除飞书 Wiki 同步，重构结构** | **AI Assistant** |

---

**文档结束**

*本 PRD 文档整合了 Phase 1 和 Phase 2 的所有需求，经过结构优化和内容补充，形成统一的需求规格说明书。如有疑问或需要调整，请联系产品团队。*
