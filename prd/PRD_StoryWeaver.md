# 需求规格说明书：StoryWeaver AI (智语拆解)

**版本**: 1.0  
**日期**: 2026-01-25  
**状态**: 拟定中

---

## 1. 项目概述 (Project Overview)

### 1.1 项目名称
**中文名称**：智语拆解  
**英文名称**：StoryWeaver AI  
**代号**：SW-Core

### 1.2 项目目标
构建一个智能化的需求拆解平台，通过自动化解析 PRD（产品需求文档），将其转化为标准化的敏捷用户故事（User Stories）。旨在消除产品经理（PM）与开发团队之间的理解鸿沟，将需求拆解耗时从“小时级”降低至“分钟级”，并确保拆解颗粒度的统一性与覆盖率。

### 1.3 目标用户
*   **产品经理 (PM)**：需要快速将长文档转化为开发Backlog，减少重复性文字工作。
*   **技术负责人 (Tech Lead)**：需要快速评估需求范围，辅助估算工时。
*   **敏捷教练/Scrum Master**：需要标准化的用户故事格式以规范敏捷流程。

### 1.4 核心价值主张
*   **效率提升**：自动化处理替代人工逐行拆解，释放核心生产力。
*   **标准统一**：强制应用“角色-活动-价值”的标准模板，避免需求描述随意。
*   **防遗漏**：通过结构化解析，确保PRD中的非功能性需求和边缘流程不被忽视。

---

## 2. 功能需求详述 (Functional Requirements)

### 2.1 PRD文档上传模块
*   **文件格式支持**：
    *   必须支持：`.docx` (Word), `.pdf` (PDF), `.txt` (纯文本)。
    *   扩展支持：`.md` (Markdown)。
*   **上传交互**：
    *   提供拖拽上传区域与点击选择文件按钮。
    *   实时显示上传进度条（百分比）及上传结果（成功/失败图标）。
*   **基础校验**：
    *   **文件大小限制**：单文件不超过 20MB。
    *   **空文件校验**：拦截内容为空的无效文档。
    *   **格式校验**：校验文件扩展名与MIME类型一致性。

### 2.2 文档内容解析与处理引擎 (Backend)
*   **接收与存储**：
    *   后端接口接收文件流，生成唯一 `file_id`。
    *   文件临时存储于服务器或对象存储，处理完成后依据策略保留或删除。
*   **文本提取**：
    *   集成 `python-docx` (针对Word)、`PyPDF2/pdfplumber` (针对PDF) 库。
    *   实现文本清洗：去除页眉、页脚、水印及无关格式字符。
*   **结构化解析逻辑**：
    *   **章节识别**：基于正则表达式和关键词（如“功能需求”、“非功能需求”、“流程图”）识别文档结构。
    *   **段落分类**：将提取的文本块标记为“业务背景”、“功能描述”、“验收标准”等类别。

### 2.3 用户故事自动生成模块 (Core Logic)
*   **生成规则 (Rule Engine)**：
    *   严格遵循模板：`As a <角色>, I want to <活动/功能>, So that <商业价值/收益>`。
*   **拆解策略**：
    *   **基于动词提取**：识别“用户可以...”、“支持...”、“允许...”等句式，提取功能点。
    *   **基于角色映射**：从文档中识别“管理员”、“普通用户”、“访客”等实体，自动填充 `<角色>` 字段。
    *   **价值推导**：若文档未显式提及价值，基于上下文生成默认价值（如“以便完成任务”），并标记为“需人工确认”。
*   **故事属性**：
    *   **Title**：功能点的简短摘要（如“用户登录功能”）。
    *   **Description**：标准用户故事文本。
    *   **Source Reference**：摘录生成该故事的原文片段，便于溯源核对。

### 2.4 用户故事输出与展示模块 (Frontend)
*   **展示面板**：
    *   采用卡片式或列表式布局展示生成的故事。
    *   左侧/顶部显示原始文档概览，右侧/主体显示拆解结果。
*   **交互操作**：
    *   **编辑**：允许用户手动修改生成的故事标题和描述。
    *   **排序与过滤**：支持按“功能模块”筛选，或按“生成置信度”排序。
    *   **删除/新增**：支持用户删除误生成的故事或手动补充遗漏故事。
*   **导出功能**：
    *   **CSV导出**：包含 Title, Description, Module, Priority 字段，适配 Jira/Excel 导入。
    *   **Markdown/Text 复制**：一键复制格式化文本。

---

## 3. 非功能性需求 (Non-Functional Requirements)

### 3.1 性能 (Performance)
*   **响应时间**：10页（约5000字）以内的标准文档，从上传到展示结果不超过 **30秒**。
*   **并发处理**：系统应支持至少 10 个并发文档处理请求而不阻塞。

### 3.2 可用性 (Usability)
*   **零学习成本**：操作流程限制在3步以内（上传 -> 等待 -> 查看/导出）。
*   **移动端适配**：虽然主要在PC端工作，但需支持移动端查看结果（响应式布局）。

### 3.3 安全性 (Security)
*   **数据隐私**：
    *   上传的PRD文档默认为“临时会话级”，用户退出或会话过期后自动从服务器删除。
    *   传输层强制使用 HTTPS。
*   **敏感信息过滤**：(可选) 在解析阶段尝试识别并掩盖明显的手机号、身份证号等敏感信息。

### 3.4 可靠性 (Reliability)
*   **异常处理**：
    *   无法解析的PDF（如纯图片扫描件）：返回明确提示“无法识别扫描件，请上传可编辑文档”。
    *   解析超时：提供“重试”机制。

---

## 4. 技术栈规范 (Technical Stack)

遵循项目全局开发规范，技术选型如下：

*   **前端 (Frontend)**：
    *   **框架**：**Flutter (Web)**
    *   **语言**：Dart
    *   **风格**：Material Design 3 或自定义企业级 UI。
    *   **规范**：使用 `dart format` 格式化代码。
*   **后端 (Backend)**：
    *   **框架**：**Python FastAPI**
    *   **语言**：Python 3.10+
    *   **文档解析**：`python-docx`, `PyPDF2`, `langchain` (预留NLP扩展能力)。
    *   **规范**：使用 `black` 和 `isort` 格式化代码，遵循 PEP8。
*   **数据存储 (Storage)**：
    *   **数据库**：SQLite (MVP阶段) -> PostgreSQL (生产环境)。
    *   **文件存储**：本地临时文件系统 (MVP阶段) -> S3/MinIO (生产环境)。

---

## 5. 项目里程碑 (Milestones)

### Phase 1: 原型与架构 (当前阶段)
*   完成需求规格说明书 (本文档)。
*   搭建 Flutter + FastAPI 项目脚手架。
*   实现基础的静态页面（上传页、结果页UI）。

### Phase 2: 核心解析能力开发
*   后端实现文件接收与基础文本提取接口。
*   开发基于规则的简单拆解算法（Rule-based Splitter）。
*   前后端联调，实现“上传-解析-展示”闭环。

### Phase 3: 优化与导出
*   优化拆解算法，引入关键词匹配提升准确率。
*   实现 CSV/Text 导出功能。
*   增加用户编辑与删除故事的功能。

### Phase 4: 发布与反馈
*   部署至测试环境。
*   邀请种子用户试用并收集反馈。

---

## 6. 成功标准 (Success Metrics)
1.  **解析成功率**：标准格式 Word 文档解析成功率 100%。
2.  **可用性验证**：生成的 story 列表中，至少 60% 无需修改即可直接使用。
3.  **流程跑通**：用户能在 1 分钟内完成从上传到获取 CSV 文件的全过程。
